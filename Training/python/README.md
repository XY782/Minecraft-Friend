# Training (Python)

This folder contains Python-side training/inference for the hybrid setup:

- Node.js (`src/`) runs live Mineflayer bot + Gemini
- Python (`Training/python/`) trains and serves policy models

## 1) Install Python deps

```bash
cd Training/python
pip install -r requirements.txt
```

## 2) Train a baseline model

Use the JSONL data generated by the Node recorder under `Training/datasets`:

Quick MLP sanity run (1-3 epochs, reduced advanced options):

```bash
python train.py --dataset ../datasets/state-action-YYYY-MM-DD.jsonl --model-type mlp --epochs 3 --baseline-mlp
```

Default Phase-2 LSTM training:

```bash
python train.py --dataset ../datasets/state-action-YYYY-MM-DD.jsonl --out-dir ../models --model-type lstm --sequence-length 8 --epochs 16 --batch-size 128 --lr 1e-3 --seed 42 --dropout 0.2 --hidden-size 128 --lstm-layers 1
```

Outputs:

- `Training/models/behavior_model.pt`
- `Training/models/behavior_model.meta.json`

Notes:
- Training now uses randomized split + class-weighted loss (helps with imbalanced action labels).
- Features include health, hunger, held-item category, nearest-entity signal, block context, and encoded intent.
- Phase-1 normalization is enabled: train-time `mean/std` is saved and reused during inference.
- Absolute world position is removed from features to improve cross-map generalization.
- Phase-2 temporal modeling is available with `--model-type lstm` + `--sequence-length`.

## 3) Run local inference API

```bash
uvicorn serve_policy:app --host 127.0.0.1 --port 8765
```

Endpoints:

- `GET /health`
- `POST /predict` with payload:

```json
{
  "state": {
    "position": { "x": 0, "y": 64, "z": 0 },
    "velocity": { "vx": 0, "vy": 0, "vz": 0 },
    "onGround": true,
    "inAir": false,
    "controls": {},
    "nearbyEntities": [],
    "inventory": []
  },
  "intent": "gather wood",
  "agent_id": "bot-1"
}
```

The response includes action label + confidence for Node integration.
For LSTM models, pass consistent `agent_id` so sequence memory is preserved across requests.
